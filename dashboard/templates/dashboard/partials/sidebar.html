<div id="layoutSidenav_nav" class="sidebar-overlay">
    <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
        <div class="sb-sidenav-menu">
            <div class="nav">
                <!-- Home Section -->
                <div class="sb-sidenav-menu-heading">Home</div>
                <a class="nav-link" href="{% url 'dashboard:dashboard' %}">
                    <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                    Dashboard
                </a>

                <!-- People Management Section -->
                {% if request.user.person.role == "HR Admin" %}
                    <div class="sb-sidenav-menu-heading">People Management</div>
                    <!-- People -->
                    
                     {% if request.user.person.role == "HR Admin" %}
                        <a class="nav-link" href="#" data-bs-toggle="collapse" data-bs-target="#collapsePeople"
                           aria-expanded="false" aria-controls="collapsePeople">
                            <div class="sb-nav-link-icon"><i class="fas fa-person"></i></div>
                            People
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>

                        <div class="collapse" id="collapsePeople" aria-labelledby="headingPeople" data-bs-parent="#sidenavAccordion">
                            <nav class="sb-sidenav-menu-nested nav">
                                <a class="nav-link" href="{% url 'people_management:people' %}">View People</a>
                                {% if request.user.person.role == "HR Admin" %}
                                    <a class="nav-link" href="{% url 'people_management:create_new_person' %}">Create Person</a>
                                {% endif %}
                            </nav>
                        </div>
                    {% endif %}

                    <!-- Contracts Section -->
                    {% if request.user.person.role == "HR Admin" %}
                        <a class="nav-link collapsed" href="#" data-bs-toggle="collapse" data-bs-target="#collapseContracts"
                           aria-expanded="false" aria-controls="collapseContracts">
                            <div class="sb-nav-link-icon"><i class="fas fa-book-open"></i></div>
                            Contracts
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>

                        <div class="collapse" id="collapseContracts" aria-labelledby="headingContracts" data-bs-parent="#sidenavAccordion">
                            <nav class="sb-sidenav-menu-nested nav">
                                <a class="nav-link" href="{% url 'people_management:contracts' %}">View Contracts</a>
                                {% if request.user.person.role == "HR Admin" %}
                                    <a class="nav-link" href="{% url 'people_management:create_contract' %}">Create Contract</a>
                                {% endif %}
                            </nav>
                        </div>
                    {% endif %}
                {% endif %}

                <!-- Task Management Section -->
                {% if request.user.person.role == "Manager" or request.user.person.role == "HR Admin" %}
                    <div class="sb-sidenav-menu-heading">Task Management</div>
                    <a class="nav-link" href="#" data-bs-toggle="collapse" data-bs-target="#collapseTasks"
                       aria-expanded="false" aria-controls="collapseTasks">
                        <div class="sb-nav-link-icon"><i class="fas fa-tasks"></i></div>
                        Tasks
                        <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                    </a>

                    <div class="collapse" id="collapseTasks" aria-labelledby="headingTasks" data-bs-parent="#sidenavAccordion">
                        <nav class="sb-sidenav-menu-nested nav">
                            <a class="nav-link" href="{% url 'task_management:task_list' %}">View Tasks</a>
                           {% if request.user.person.role == "HR Admin" %}
                                <a class="nav-link" href="{% url 'task_management:task_create' %}">Create Task</a>
                            {% endif %}
                        </nav>
                    </div>
                {% endif %}

                <!-- Security Section -->
                {% if perms.auth.view_user or perms.auth.view_group or perms.security.view_securitylog %}
                    <div class="sb-sidenav-menu-heading">Security</div>
                    <!-- Users -->
                    {% if perms.auth.view_user %}
                        <a class="nav-link" href="#" data-bs-toggle="collapse" data-bs-target="#collapseUsers" aria-expanded="false" aria-controls="collapseUsers">
                            <div class="sb-nav-link-icon"><i class="fas fa-cogs"></i></div>
                            Users
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>
                        <div class="collapse" id="collapseUsers" aria-labelledby="headingUsers" data-bs-parent="#sidenavAccordion">
                            <nav class="sb-sidenav-menu-nested nav">
                                <a class="nav-link" href="{% url 'security:user_list' %}">View Users</a>
                                {% if perms.auth.add_user %}
                                    <a class="nav-link" href="{% url 'security:user_create' %}">Create User</a>
                                {% endif %}
                            </nav>
                        </div>
                    {% endif %}
                    <!-- Groups -->
                    {% if perms.auth.view_group %}
                        <a class="nav-link" href="#" data-bs-toggle="collapse" data-bs-target="#collapseGroups" aria-expanded="false" aria-controls="collapseGroups">
                            <div class="sb-nav-link-icon"><i class="fa-solid fa-universal-access"></i></div>
                            Groups
                            <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                        </a>
                        <div class="collapse" id="collapseGroups" aria-labelledby="headingGroups" data-bs-parent="#sidenavAccordion">
                            <nav class="sb-sidenav-menu-nested nav">
                                <a class="nav-link" href="{% url 'security:group_list' %}">View Groups</a>
                                {% if perms.auth.add_group %}
                                    <a class="nav-link" href="{% url 'security:group_add' %}">Create Group</a>
                                {% endif %}
                            </nav>
                        </div>
                    {% endif %}
                    <!-- Audit Log -->
                    {% if perms.security.view_securitylog %}
                        <a class="nav-link" href="{% url 'security:audit_log' %}">
                            <div class="sb-nav-link-icon"><i class="fa-solid fa-file-lines"></i></div>
                            Audit Log
                        </a>
                    {% endif %}
                {% endif %}
            </div>
        </div>
        <div class="sb-sidenav-footer">
            <div class="small">Logged in as:</div>
            <div>
                {% if request.user.person %}
                    {{ request.user.person.first_name }} {{ request.user.person.last_name }}
                {% else %}
                    {{ request.user.username }}  <!-- Fallback if no Person record exists -->
                {% endif %}
            </div>  <!-- Displays the full name of the logged-in user -->
        </div>
    </nav>
</div>
